<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gun Game - Full Version</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #111;
    color: white;
    overflow: hidden;
  }
  #gameCanvas {
    display: none;
    background: #111;
  }
  #charSelect {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
  }
  .charCard {
    border: 2px solid white;
    padding: 20px;
    margin: 10px;
    cursor: pointer;
    width: 200px;
    text-align: center;
    user-select: none;
    transition: background 0.3s;
  }
  .charCard:hover {
    background: #333;
  }
  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-family: sans-serif;
    z-index: 10;
  }
  #upgradeOverlay button {
    background: #222;
    color: white;
    border: 2px solid white;
    padding: 12px 20px;
    margin: 10px;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.2s;
  }
  #upgradeOverlay button:hover {
    background: #444;
  }
</style>
</head>
<body>
<div id="charSelect">
  <h1>Select Your Character</h1>
  <div class="charCard" onclick="startGame('Soldier')">
    <h2>Soldier</h2>
    <p>Health: 100</p>
    <p>Speed: 5</p>
    <p>Fire Rate: Medium</p>
  </div>
  <div class="charCard" onclick="startGame('Scout')">
    <h2>Scout</h2>
    <p>Health: 70</p>
    <p>Speed: 7</p>
    <p>Fire Rate: Fast</p>
  </div>
  <div class="charCard" onclick="startGame('Tank')">
    <h2>Tank</h2>
    <p>Health: 150</p>
    <p>Speed: 3</p>
    <p>Fire Rate: Slow</p>
  </div>
</div>

<div id="ui">
  <div id="score">Score: 0</div>
  <div id="health">Health: 100</div>
  <div id="wave">Wave: 1</div>
</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {}, keys = {}, bullets = [], enemies = [], score = 0, wave = 1;
let mouse = { x: canvas.width / 2, y: canvas.height / 2 };
let canShoot = true,
  fireRate = 400,
  damage = 1,
  ammoSpread = 1,
  upgradePending = false,
  bossActive = false,
  bossAttackCooldown = 0;

const characters = {
  Soldier: { health: 100, speed: 5, fireRate: 400 },
  Scout: { health: 70, speed: 7, fireRate: 200 },
  Tank: { health: 150, speed: 3, fireRate: 700 },
};

const upgrades = [
  { name: "ðŸ’¥ Damage Up", apply: () => damage++ },
  {
    name: "âš¡ Fire Rate Up",
    apply: () => {
      fireRate = Math.max(100, fireRate - 50);
    },
  },
  {
    name: "ðŸ“¦ Spread Shot",
    apply: () => {
      ammoSpread = Math.min(3, ammoSpread + 1);
    },
  },
];

function startGame(character) {
  document.getElementById("charSelect").style.display = "none";
  canvas.style.display = "block";

  const charStats = characters[character];
  player = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    size: 20,
    health: charStats.health,
    speed: charStats.speed,
  };
  fireRate = charStats.fireRate;
  damage = 1;
  ammoSpread = 1;
  score = 0;
  wave = 1;
  upgradePending = false;
  bossActive = false;
  bossAttackCooldown = 0;
  enemies = [];

  spawnEnemies(wave * 3);
  loop();
}

window.addEventListener("keydown", (e) => (keys[e.key] = true));
window.addEventListener("keyup", (e) => (keys[e.key] = false));
window.addEventListener("mousemove", (e) => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});
window.addEventListener("click", () => {
  if (!upgradePending && canShoot) {
    shoot();
    canShoot = false;
    setTimeout(() => (canShoot = true), fireRate);
  }
});

const shootSound = new Audio(
  "https://cdn.pixabay.com/download/audio/2022/03/15/audio_8770a2d12c.mp3?filename=gunshot-108577.mp3"
);
const bossAttackSound = new Audio(
  "https://cdn.pixabay.com/download/audio/2021/08/04/audio_841462663e.mp3?filename=laser-attack-13675.mp3"
);

function shoot() {
  const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
  for (let i = 0; i < ammoSpread; i++) {
    let spread = (i - (ammoSpread - 1) / 2) * 0.15;
    bullets.push({
      x: player.x,
      y: player.y,
      dx: Math.cos(angle + spread) * 10,
      dy: Math.sin(angle + spread) * 10,
    });
  }
  shootSound.currentTime = 0;
  shootSound.play();
}

function spawnEnemies(count) {
  enemies = [];
  bossActive = false;
  for (let i = 0; i < count; i++) {
    let x = Math.random() < 0.5 ? 0 : canvas.width;
    let y = Math.random() * canvas.height;
    enemies.push({
      x,
      y,
      size: 25 + wave * 2,
      speed: 1 + wave * 0.2,
      health: 2 + wave,
      isBoss: false,
    });
  }
}

function spawnBoss() {
  bossActive = true;
  enemies = [
    {
      x: canvas.width / 2,
      y: 100,
      size: 80,
      speed: 1,
      health: 20 + wave * 10,
      maxHealth: 20 + wave * 10,
      isBoss: true,
    },
  ];
}

function drawPlayer() {
  ctx.save();
  ctx.translate(player.x, player.y);
  const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
  ctx.rotate(angle);
  ctx.fillStyle = "lime";
  ctx.fillRect(-player.size / 2, -player.size / 2, player.size, player.size);
  ctx.fillStyle = "orange";
  ctx.fillRect(player.size / 2, -5, 20, 10);
  ctx.restore();
}

function update() {
  if (upgradePending) return;

  if (keys["w"]) player.y -= player.speed;
  if (keys["s"]) player.y += player.speed;
  if (keys["a"]) player.x -= player.speed;
  if (keys["d"]) player.x += player.speed;

  // Keep player inside bounds
  player.x = Math.max(player.size / 2, Math.min(canvas.width - player.size / 2, player.x));
  player.y = Math.max(player.size / 2, Math.min(canvas.height - player.size / 2, player.y));

  bullets.forEach((b, i) => {
    b.x += b.dx;
    b.y += b.dy;
    if (b.x < 0 || b.y < 0 || b.x > canvas.width || b.y > canvas.height)
      bullets.splice(i, 1);
  });

  enemies.forEach((e, i) => {
    if (e.isBoss) {
      bossBehavior(e);
    } else {
      let dx = player.x - e.x;
      let dy = player.y - e.y;
      let dist = Math.hypot(dx, dy);
      e.x += (dx / dist) * e.speed;
      e.y += (dy / dist) * e.speed;
    }

    let distPlayer = Math.hypot(e.x - player.x, e.y - player.y);
    if (distPlayer < player.size + e.size) {
      player.health -= e.isBoss ? 30 : 10;
      enemies.splice(i, 1);
      if (player.health <= 0) {
        alert("Game Over! Final Score: " + score);
        document.location.reload();
      }
    }

    bullets.forEach((b, j) => {
      if (Math.hypot(e.x - b.x, e.y - b.y) < e.size) {
        e.health -= damage;
        bullets.splice(j, 1);
        if (e.health <= 0) {
          enemies.splice(i, 1);
          score += e.isBoss ? 100 : 10;
        }
      }
    });
  });

  if (enemies.length === 0 && !upgradePending) {
    if (wave % 5 === 0) {
      spawnBoss();
    } else {
      wave++;
      spawnEnemies(wave * 3);
    }
    if (wave % 5 !== 0) {
      upgradePending = true;
      showUpgradeMenu();
    }
  }

  document.getElementById("score").textContent = "Score: " + score;
  document.getElementById("health").textContent = "Health: " + player.health;
  document.getElementById("wave").textContent = "Wave: " + wave;
}

function bossBehavior(boss) {
  // Boss moves left-right slowly
  boss.x += boss.speed;
  if (boss.x > canvas.width - boss.size / 2 || boss.x < boss.size / 2) boss.speed *= -1;

  // Boss attacks every 2 seconds
  if (bossAttackCooldown <= 0) {
    bossAttackCooldown = 120; // frames (about 2 seconds at 60fps)
    bossAttack();
  } else {
    bossAttackCooldown--;
  }
}

function bossAttack() {
  bossAttackSound.currentTime = 0;
  bossAttackSound.play();
  // Simple: boss shoots a damaging laser line across player y
  // If player is in line, lose health
  if (player.y > canvas.height / 2 - 30 && player.y < canvas.height / 2 + 30) {
    player.health -= 20;
    if (player.health <= 0) {
      alert("Game Over! Final Score: " + score);
      document.location.reload();
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawPlayer();

  bullets.forEach((b) => {
    ctx.beginPath();
    ctx.fillStyle = "yellow";
    ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
    ctx.fill();
  });

  enemies.forEach((e) => {
    ctx.beginPath();
    ctx.fillStyle = e.isBoss ? "red" : "white";
    ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    ctx.fill();

    // Draw boss health bar
    if (e.isBoss) {
      ctx.fillStyle = "black";
      ctx.fillRect(e.x - 50, e.y - e.size - 20, 100, 10);
      ctx.fillStyle = "lime";
      ctx.fillRect(e.x - 50, e.y - e.size - 20, (e.health / e.maxHealth) * 100, 10);
    }
  });
}

function loop() {
  update();
  draw();
  if (!upgradePending) requestAnimationFrame(loop);
}

function showUpgradeMenu() {
  const overlay = document.createElement("div");
  overlay.id = "upgradeOverlay";
  overlay.style.position = "fixed";
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = "100vw";
  overlay.style.height = "100vh";
  overlay.style.backgroundColor = "rgba(0,0,0,0.85)";
  overlay.style.display = "flex";
  overlay.style.flexDirection = "column";
  overlay.style.justifyContent = "center";
  overlay.style.alignItems = "center";
  overlay.style.zIndex = "1000";

  const title = document.createElement("h2");
  title.textContent = "Choose Your Upgrade";
  overlay.appendChild(title);

  upgrades.forEach((upg, idx) => {
    const btn = document.createElement("button");
    btn.textContent = upg.name;
    btn.onclick = () => {
      upg.apply();
      upgradePending = false;
      document.body.removeChild(overlay);
      wave++;
      spawnEnemies(wave * 3);
      loop();
    };
    overlay.appendChild(btn);
  });

  document.body.appendChild(overlay);
}
</script>
</body>
</html>
